<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏ –û–Ω–ª–∞–π–Ω</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-width: 500px;
            width: 90%;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .menu {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .input-group {
            margin: 1rem 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .game-board {
            display: none;
            text-align: center;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 2rem 0;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 12px;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 80px;
        }

        .cell:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .cell.disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }

        .game-info {
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            text-align: center;
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin: 1rem 0;
            font-size: 1.1rem;
        }

        .room-code {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .winner-announcement {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .winner-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .winner-content h2 {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .connection-methods {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin: 2rem 0;
        }

        @media (min-width: 768px) {
            .connection-methods {
                grid-template-columns: 1fr 1fr;
            }
        }

        .method-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: all 0.3s ease;
        }

        .method-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-5px);
        }

        .method-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                margin: 1rem;
                padding: 1.5rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .cell {
                min-height: 60px;
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ –ö—Ä–µ—Å—Ç–∏–∫–∏-–ù–æ–ª–∏–∫–∏</h1>
        
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu" class="menu">
            <div class="connection-methods">
                <div class="method-card">
                    <div class="method-icon">üíª</div>
                    <h3>–° –∫–æ–º–ø—å—é—Ç–µ—Ä–∞</h3>
                    <p>–ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–æ–º —ç–∫—Ä–∞–Ω–µ</p>
                </div>
                <div class="method-card">
                    <div class="method-icon">üì±</div>
                    <h3>–° —Ç–µ–ª–µ—Ñ–æ–Ω–∞</h3>
                    <p>–£–¥–æ–±–Ω–∞—è –º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è</p>
                </div>
            </div>
            
            <button class="btn" onclick="showCreateRoom()">üè† –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            <button class="btn" onclick="showJoinRoom()">üö™ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ</button>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã -->
        <div id="create-room" class="menu" style="display: none;">
            <div class="input-group">
                <label for="player-name">–í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="player-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            <button class="btn" onclick="createRoom()">üéØ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
            <button class="back-btn" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ -->
        <div id="join-room" class="menu" style="display: none;">
            <div class="input-group">
                <label for="join-name">–í–∞—à–µ –∏–º—è:</label>
                <input type="text" id="join-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            <div class="input-group">
                <label for="room-id">–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã:</label>
                <input type="text" id="room-id" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã">
            </div>
            <button class="btn" onclick="joinRoom()">üîó –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <button class="back-btn" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        </div>

        <!-- –û–∂–∏–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞ -->
        <div id="waiting-room" class="game-board">
            <h2>üé≤ –ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞!</h2>
            <div class="room-code">
                <strong>–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã: <span id="room-code-display"></span></strong>
            </div>
            <p>–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —ç—Ç–∏–º –∫–æ–¥–æ–º —Å –¥—Ä—É–≥–æ–º —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</p>
            <div class="game-info">
                <p>‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</p>
            </div>
            <button class="back-btn" onclick="leaveRoom()">‚Üê –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É</button>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
        <div id="game-board" class="game-board">
            <div class="player-info">
                <div>üë§ <span id="player1-name">–ò–≥—Ä–æ–∫ 1</span> (X)</div>
                <div>üë§ <span id="player2-name">–ò–≥—Ä–æ–∫ 2</span> (O)</div>
            </div>
            
            <div class="game-info">
                <p id="turn-info">üéØ –•–æ–¥ –∏–≥—Ä–æ–∫–∞ X</p>
            </div>

            <div class="board" id="board">
                <button class="cell" onclick="makeMove(0)"></button>
                <button class="cell" onclick="makeMove(1)"></button>
                <button class="cell" onclick="makeMove(2)"></button>
                <button class="cell" onclick="makeMove(3)"></button>
                <button class="cell" onclick="makeMove(4)"></button>
                <button class="cell" onclick="makeMove(5)"></button>
                <button class="cell" onclick="makeMove(6)"></button>
                <button class="cell" onclick="makeMove(7)"></button>
                <button class="cell" onclick="makeMove(8)"></button>
            </div>

            <button class="back-btn" onclick="leaveRoom()">‚Üê –ü–æ–∫–∏–Ω—É—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>

    <!-- –û–∫–Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è -->
    <div id="winner-modal" class="winner-announcement">
        <div class="winner-content">
            <h2 id="winner-text">üéâ</h2>
            <button class="btn" onclick="newGame()">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button class="back-btn" onclick="leaveRoom()">‚Üê –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.22.2/firebase-database-compat.min.js"></script>

    <script>
        // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const firebaseConfig = {
            apiKey: "AIzaSyC2oMcl5rA1lzPfEHV_64Gbws6HY0aQnl0",
            authDomain: "tic-tac-toe-game-fabc6.firebaseapp.com",
            databaseURL: "https://tic-tac-toe-game-fabc6-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "tic-tac-toe-game-fabc6",
            storageBucket: "tic-tac-toe-game-fabc6.firebasestorage.app",
            messagingSenderId: "263844844415",
            appId: "1:263844844415:web:2628932fa93f59be75804a"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω—ã
        let currentRoom = null;
        let playerName = '';
        let playerSymbol = null;
        let isMyTurn = false;
        let gameBoard = ['', '', '', '', '', '', '', '', ''];

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
        function showMainMenu() {
            document.getElementById('main-menu').style.display = 'flex';
            document.getElementById('create-room').style.display = 'none';
            document.getElementById('join-room').style.display = 'none';
            document.getElementById('waiting-room').style.display = 'none';
            document.getElementById('game-board').style.display = 'none';
        }

        function showCreateRoom() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('create-room').style.display = 'flex';
        }

        function showJoinRoom() {
            document.getElementById('main-menu').style.display = 'none';
            document.getElementById('join-room').style.display = 'flex';
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        function createRoom() {
            const name = document.getElementById('player-name').value.trim();
            if (!name) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                return;
            }

            playerName = name;
            const roomId = generateRoomId();
            currentRoom = roomId;

            const roomData = {
                players: {
                    player1: {
                        name: playerName,
                        symbol: 'X'
                    }
                },
                gameState: {
                    board: gameBoard,
                    currentTurn: 'X',
                    winner: null,
                    gameActive: false
                },
                createdAt: Date.now()
            };

            database.ref('rooms/' + roomId).set(roomData)
                .then(() => {
                    playerSymbol = 'X';
                    document.getElementById('room-code-display').textContent = roomId;
                    document.getElementById('main-menu').style.display = 'none';
                    document.getElementById('create-room').style.display = 'none';
                    document.getElementById('waiting-room').style.display = 'block';
                    
                    // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–Ω–∞—Ç–µ
                    listenToRoom(roomId);
                })
                .catch((error) => {
                    alert('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã: ' + error.message);
                });
        }

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const name = document.getElementById('join-name').value.trim();
            const roomId = document.getElementById('room-id').value.trim().toUpperCase();
            
            if (!name || !roomId) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }

            playerName = name;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
            database.ref('rooms/' + roomId).once('value')
                .then((snapshot) => {
                    if (!snapshot.exists()) {
                        alert('–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                        return;
                    }

                    const roomData = snapshot.val();
                    if (roomData.players.player2) {
                        alert('–ö–æ–º–Ω–∞—Ç–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞');
                        return;
                    }

                    // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
                    database.ref('rooms/' + roomId + '/players/player2').set({
                        name: playerName,
                        symbol: 'O'
                    }).then(() => {
                        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏–≥—Ä—É
                        database.ref('rooms/' + roomId + '/gameState/gameActive').set(true);
                        
                        currentRoom = roomId;
                        playerSymbol = 'O';
                        
                        document.getElementById('main-menu').style.display = 'none';
                        document.getElementById('join-room').style.display = 'none';
                        
                        // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–Ω–∞—Ç–µ
                        listenToRoom(roomId);
                    });
                })
                .catch((error) => {
                    alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message);
                });
        }

        // –°–ª—É—à–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–º–Ω–∞—Ç–µ
        function listenToRoom(roomId) {
            database.ref('rooms/' + roomId).on('value', (snapshot) => {
                if (!snapshot.exists()) {
                    alert('–ö–æ–º–Ω–∞—Ç–∞ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞');
                    showMainMenu();
                    return;
                }

                const roomData = snapshot.val();
                updateGameUI(roomData);
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–≥—Ä—ã
        function updateGameUI(roomData) {
            const { players, gameState } = roomData;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤—Ç–æ—Ä–æ–π –∏–≥—Ä–æ–∫
            if (!players.player2) {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ–∂–∏–¥–∞–Ω–∏—è
                document.getElementById('waiting-room').style.display = 'block';
                document.getElementById('game-board').style.display = 'none';
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ
            document.getElementById('waiting-room').style.display = 'none';
            document.getElementById('game-board').style.display = 'block';

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –∏–≥—Ä–æ–∫–æ–≤
            document.getElementById('player1-name').textContent = players.player1.name;
            document.getElementById('player2-name').textContent = players.player2.name;

            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å–∫—É
            gameBoard = gameState.board;
            const cells = document.querySelectorAll('.cell');
            cells.forEach((cell, index) => {
                cell.textContent = gameBoard[index];
                cell.classList.toggle('disabled', gameBoard[index] !== '' || !gameState.gameActive);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ–¥–µ
            isMyTurn = gameState.currentTurn === playerSymbol && gameState.gameActive;
            document.getElementById('turn-info').textContent = 
                isMyTurn ? 'üéØ –í–∞—à —Ö–æ–¥!' : `üéØ –•–æ–¥ –∏–≥—Ä–æ–∫–∞ ${gameState.currentTurn}`;

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            if (gameState.winner) {
                showWinner(gameState.winner, players);
            }
        }

        // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
        function makeMove(index) {
            if (!isMyTurn || gameBoard[index] !== '') return;

            gameBoard[index] = playerSymbol;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
            const winner = checkWinner();
            const isDraw = gameBoard.every(cell => cell !== '');
            
            const updates = {
                [`rooms/${currentRoom}/gameState/board`]: gameBoard,
                [`rooms/${currentRoom}/gameState/currentTurn`]: playerSymbol === 'X' ? 'O' : 'X'
            };

            if (winner) {
                updates[`rooms/${currentRoom}/gameState/winner`] = winner;
                updates[`rooms/${currentRoom}/gameState/gameActive`] = false;
            } else if (isDraw) {
                updates[`rooms/${currentRoom}/gameState/winner`] = 'draw';
                updates[`rooms/${currentRoom}/gameState/gameActive`] = false;
            }

            database.ref().update(updates);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        function checkWinner() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                [0, 4, 8], [2, 4, 6] // –¥–∏–∞–≥–æ–Ω–∞–ª–∏
            ];

            for (let pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (gameBoard[a] && gameBoard[a] === gameBoard[b] && gameBoard[a] === gameBoard[c]) {
                    return gameBoard[a];
                }
            }
            return null;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        function showWinner(winner, players) {
            const modal = document.getElementById('winner-modal');
            const winnerText = document.getElementById('winner-text');
            
            if (winner === 'draw') {
                winnerText.textContent = 'ü§ù –ù–∏—á—å—è!';
            } else if (winner === playerSymbol) {
                winnerText.textContent = 'üéâ –í—ã –ø–æ–±–µ–¥–∏–ª–∏!';
            } else {
                const winnerName = winner === 'X' ? players.player1.name : players.player2.name;
                winnerText.textContent = `üèÜ –ü–æ–±–µ–¥–∏–ª ${winnerName}!`;
            }
            
            modal.style.display = 'flex';
        }

        // –ù–æ–≤–∞—è –∏–≥—Ä–∞
        function newGame() {
            gameBoard = ['', '', '', '', '', '', '', '', ''];
            
            const updates = {
                [`rooms/${currentRoom}/gameState/board`]: gameBoard,
                [`rooms/${currentRoom}/gameState/currentTurn`]: 'X',
                [`rooms/${currentRoom}/gameState/winner`]: null,
                [`rooms/${currentRoom}/gameState/gameActive`]: true
            };

            database.ref().update(updates);
            
            document.getElementById('winner-modal').style.display = 'none';
        }

        // –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
        function leaveRoom() {
            if (currentRoom) {
                database.ref('rooms/' + currentRoom).off();
                database.ref('rooms/' + currentRoom).remove();
                currentRoom = null;
                playerSymbol = null;
                isMyTurn = false;
                gameBoard = ['', '', '', '', '', '', '', '', ''];
            }
            
            document.getElementById('winner-modal').style.display = 'none';
            showMainMenu();
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –∫–æ–º–Ω–∞—Ç—ã
        function generateRoomId() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let result = '';
            for (let i = 0; i < 6; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('player-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') createRoom();
            });
            
            document.getElementById('join-name').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') document.getElementById('room-id').focus();
            });
            
            document.getElementById('room-id').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') joinRoom();
            });
        });
    </script>
</body>
</html>
